# Soldier-Behavior-Trees

Демонстрация ИИ для солдата используя BhvTree на Unreal Engine 5.

## Дерево поведения солдата

![](BehTree.png)

## Узлы

### Задачи

#### GetRandomPoint
Узел, в котором вычисляется случайная точка в navMesh пространстве куда агент может потенциально встать.
* **success** - записывает в blackboard точку для потенциального перемещения.
* **failure** - Не может найти точку куда navMesh агент модет встать.

#### MoveTo
Узел передающий navMesh агенту точку для передвижения.
* **success** - агент достиг цели.
* **failure** - агент не может достигуть точки.

#### Wait
Узел останавливающий поток дерева поведения.
* **success** - время ожидания истекло.
* **failure** - агент не может достигуть точки.

#### RunAway
Узел передающий navMesh агенту точку для передвижения отдалённую на растояние от точки которую надо избегать.
* **success** - агент находится на достаточной расстоянии, считая что он убежал.
* **failure** - агент не знает куда бежать.

#### CheckAmmoInGun
Узел проверящий blackboard переменные о патронах в магазине, в инвентаре.
* **success** - проверил патроны.
* **failure** - патроны в инвентаре закончились, перезарядка невозможна.

#### Reload
Узел передающий команду View на перезарядку.
* **success** - анимация перезарядки произошла, магазин перезаряжен успешно.
* **failure** - патроны в инвентаре закончились, перезарядка невозможна.

#### Reload
Узел передающий команду View на перезарядку.
* **success** - анимация перезарядки произошла, магазин перезаряжен успешно.
* **failure** - патроны в инвентаре закончились, перезарядка невозможна.

#### Rotate to face BB entry
Поворачивает агента к точке.
* **success** - агент повернулся к цели.
* **failure** - агент не может повернуться к цели.

#### Shoot
Запускает анимации и логику стрельбы оружия.
* **success** - выстрел прошёл успешно.
* **failure** - выстрел невозможен.

#### DoSlaughter
Запускает анимации и логику атаки оружия ближнего боя.
* **success** - удар прошёл успешно.
* **failure** - удар невозможен.

### Узлы исполнения последовательности

#### GoTo
Узел который передвигает navMesh агента.
* **success** - агент дошёл до точки.
* **failure** - агент почему то не может дойти до точки.

#### Shoot and Wait
Узел отвечающий за стрельбу с задержкой.
* **success** - все выстрелы были произведены.
* **failure** - не все выстрелы были произведены или выстрелов не было вовсе.

#### Check Ammo
Узел отвечающий за перезарядку оружия.
* **success** - оружие теперь заряжено и готово к бою.
* **failure** - оружие не было перезаряжено.

#### Rotate and Shoot
Узел поворачивающий модель к цели с последующей стрельбой по ней.
* **success** - выстрел по цели был произведён.
* **failure** - выстрело не было.

#### Patrol
Узел отвечающий за потрулирование бота и последующией реакцией на найденных врагов.
* **success** - потруль прошёл успешно.
* **failure** - что то помешало потрулированию.

### Селекторы

#### Выбор режма боя
Узел устанавливающий как будет действовать бот на видимых им врагов.
* **success** - атака произошла успешно.
* **failure** - атаке что то помешало или атаки не было вовсе.

### Параллельные узлы

#### Ждать на месте
Узел ожидания с последующим реагированием на видимых врагов. 
* **success** - Ожидание прошло успешно.
* **failure** - Что то прервало ожидание.

### Декораторы

* **Если врагов нет** - Условие при котором в blackboard колличество видимых врагов равна 0

* **Если есть враг** - Условие при котором в blackboard колличество видимых врагов не равна 0

* **Если ХП > 20%** - Условие при котором в blackboard процентное соотношение здоровья актёра > 20%

* **Если ХП < 20%** - Условие при котором в blackboard процентное соотношение здоровья актёра < 20%

* **Если есть патроны** - Условие при котором в blackboard переменная колличества патрон данного типа оружия в инвентаре не равно 0

* **Если нет патрон** - Условие при котором в blackboard переменная колличества патрон в магазине равна 0

